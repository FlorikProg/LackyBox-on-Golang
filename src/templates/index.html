<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="file/css/styles.css">
    <title>Lucky Box</title>
</head>
<body>
<!-- Top Clovers -->
<img src="file/img/chetyrehlistnij_klever.png" class="clover top-clover top-left-clover" alt="Clover">
<img src="file/img/chetyrehlistnij_klever.png" class="clover top-clover top-right-clover" alt="Clover">

<!-- Middle Clovers -->
<img src="file/img/chetyrehlistnij_klever.png" class="clover middle-clover middle-left-clover" alt="Clover">
<img src="file/img/chetyrehlistnij_klever.png" class="clover middle-clover middle-right-clover" alt="Clover">

<!-- Bottom Clovers -->
<img src="file/img/chetyrehlistnij_klever.png" class="clover bottom-clover bottom-left-clover" alt="Clover">
<img src="file/img/chetyrehlistnij_klever.png" class="clover bottom-clover bottom-right-clover" alt="Clover">

<div class="container">
    <div>
        <h1>Lucky Box</h1>
        <img id="boxImage" class="box-img" src="file/img/close.png" alt="Closed Box">
        <button id="openButton">Open</button>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
    document.getElementById('openButton').addEventListener('click', function() {
        var boxImage = document.getElementById('boxImage');
        var button = document.getElementById('openButton');

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å—Ä–∞–∑—É
        button.remove();

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ fade-out –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞
        boxImage.classList.add('fade-out');

        // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
        setTimeout(function() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ –º–µ–∂–¥—É 0 –∏ 1
            var randomNumber = Math.random();

            // 80% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å "open.png", 20% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å –∞–ª–º–∞–∑–Ω—ã–π —ç–º–æ–¥–∑–∏
            if (randomNumber < 0.8) {
                boxImage.src = 'file/img/open.png'; // –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–æ—Ä–æ–±–∫–∏
            } else {
                // –ó–∞–º–µ–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∞–ª–º–∞–∑–Ω—ã–π —ç–º–æ–¥–∑–∏
                boxImage.style.display = 'none'; // –°–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                var emoji = document.createElement('span');
                var text_win = document.createElement('h2');
                text_win.textContent = '–í–´–ò–ì–†–´–®';
                emoji.textContent = 'üíé';
                emoji.className = 'diamond-emoji'; // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å –∞–ª–º–∞–∑–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏
                boxImage.parentElement.appendChild(emoji);
                boxImage.parentElement.appendChild(text_win);

                // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∞–ª–º–∞–∑–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏
                var rect = emoji.getBoundingClientRect();
                var x = (rect.left + rect.right) / 2 / window.innerWidth;
                var y = (rect.top + rect.bottom) / 2 / window.innerHeight;

                // –ó–∞–ø—É—Å–∫ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –∞–ª–º–∞–∑–∞
                confetti({
                    particleCount: 200, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü
                    spread: 360, // –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–∞—Å—Ç–∏—Ü—ã –≤–æ –≤—Å–µ—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
                    origin: { x: x, y: y } // –ù–∞—á–∞—Ç—å —Å –ø–æ–∑–∏—Ü–∏–∏ –∞–ª–º–∞–∑–∞
                });

                // –í—ã–∑–æ–≤ API –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π
                fetch('/increment-win', { method: 'POST' }).then(response => {
                    if (!response.ok) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π');
                    }
                });
            }

            // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ fade-out –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            boxImage.classList.remove('fade-out');
        }, 500); // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CSS-–ø–µ—Ä–µ—Ö–æ–¥–∞
    });
</script>
</body>
</html>
